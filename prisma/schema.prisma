generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

model User {
  clerkId                  String            @unique
  email                    String            @unique
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  firstName                String?
  lastName                 String?
  stripeCustomerId         String?           @unique
  stripePriceId            String?
  stripeSubscriptionId     String?
  stripeSubscriptionStatus String?
  id                       Int               @id @default(autoincrement())
  role                     UserRole          @default(user)
  aiDraftCredits           Int               @default(5)
  aiTestCredits            Int               @default(2)
  murmurEmail              String?           @unique
  customDomain             String?
  draftCredits             Float             @default(0)
  sendingCredits           Float             @default(0)
  verificationCredits      Float             @default(0)
  lastCreditUpdate         DateTime?
  stripePromoCode          String?
  campaigns                Campaign[]
  contacts                 Contact[]
  contactLists             ContactList[]
  emails                   Email[]
  identities               Identity[]
  signatures               Signature[]
  userContactLists         UserContactList[]
  inboundEmails            InboundEmail[]
}

model ContactList {
  name      String     @unique(map: "ContactList_category_key")
  count     Int?       @default(0)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  id        Int        @id @default(autoincrement())
  userId    String?
  title     String     @default("Untitled Contact List")
  contacts  Contact[]
  user      User?      @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  campaigns Campaign[] @relation("CampaignToContactList")

  @@index([userId])
}

model UserContactList {
  id        Int        @id @default(autoincrement())
  name      String
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User       @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  campaigns Campaign[] @relation("CampaignToUserContactList")
  contacts  Contact[]  @relation("ContactToUserContactList")

  @@index([userId])
}

model Contact {
  email                    String
  company                  String?
  country                  String?
  createdAt                DateTime                @default(now())
  phone                    String?
  state                    String?
  updatedAt                DateTime                @updatedAt
  website                  String?
  id                       Int                     @id @default(autoincrement())
  contactListId            Int?
  address                  String?
  apolloPersonId           String?                 @unique
  city                     String?
  emailValidatedAt         DateTime?
  emailValidationStatus    EmailVerificationStatus @default(unknown)
  emailValidationSubStatus String?
  firstName                String?
  headline                 String?
  lastName                 String?
  linkedInUrl              String?
  photoUrl                 String?
  title                    String?
  metadata                 String?
  userId                   String?
  isPrivate                Boolean                 @default(false)
  hasVectorEmbedding       Boolean                 @default(false)
  userContactListCount     Int                     @default(0)
  manualDeselections       Int                     @default(0)
  companyFoundedYear       String?
  companyIndustry          String?
  companyKeywords          String[]
  companyLinkedInUrl       String?
  companyPostalCode        String?
  companyTechStack         String[]
  companyType              String?
  lastResearchedDate       DateTime?
  latitude                 Float?
  longitude                Float?
  contactList              ContactList?            @relation(fields: [contactListId], references: [id], onDelete: Cascade)
  user                     User?                   @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  Email                    Email[]
  campaigns                Campaign[]              @relation("CampaignToContact")
  userContactLists         UserContactList[]       @relation("ContactToUserContactList")
  inboundEmails            InboundEmail[]

  @@unique([email, contactListId])
  @@index([contactListId])
  @@index([userId])
}

model Email {
  subject    String
  message    String
  status     EmailStatus @default(draft)
  sentAt     DateTime?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  userId     String
  id         Int         @id @default(autoincrement())
  campaignId Int
  contactId  Int
  campaign   Campaign    @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  contact    Contact     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  user       User        @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  replies    InboundEmail[] @relation("EmailReplies")

  @@index([campaignId])
}

model Campaign {
  name                  String
  userId                String
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  id                    Int               @id @default(autoincrement())
  fullAiPrompt          String?           @map("message")
  subject               String?
  testMessage           String?
  testSubject           String?
  senderEmail           String?
  senderName            String?
  status                Status            @default(active)
  signatureId           Int?
  font                  String            @default("Arial")
  identityId            Int?
  draftingMode          DraftingMode      @default(hybrid)
  draftingTone          DraftingTone      @default(normal)
  handwrittenPrompt     String?
  hybridPrompt          String?
  isAiSubject           Boolean           @default(true)
  paragraphs            Int?              @default(0)
  hybridBlockPrompts    Json?             @default("[{\"id\": \"full_automated\", \"type\": \"full_automated\", \"value\": \"\"}]")
  hybridAvailableBlocks HybridBlock[]     @default([full_automated, introduction, research, action, text])
  identity              Identity?         @relation(fields: [identityId], references: [id])
  signature             Signature?        @relation(fields: [signatureId], references: [id])
  user                  User              @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  emails                Email[]
  contacts              Contact[]         @relation("CampaignToContact")
  contactLists          ContactList[]     @relation("CampaignToContactList")
  userContactLists      UserContactList[] @relation("CampaignToUserContactList")
  inboundEmails         InboundEmail[]

  @@index([userId])
}

model Identity {
  id        Int        @id @default(autoincrement())
  name      String
  website   String?
  email     String
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  campaigns Campaign[]
  user      User       @relation(fields: [userId], references: [clerkId], onDelete: Cascade)

  @@index([userId])
}

model Signature {
  id        Int        @id @default(autoincrement())
  content   String     @default("")
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  name      String
  campaigns Campaign[]
  user      User       @relation(fields: [userId], references: [clerkId], onDelete: Cascade)

  @@index([userId])
}

model EmailVerificationCode {
  id        Int      @id @default(autoincrement())
  email     String
  code      String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@unique([email, code])
  @@index([email])
  @@index([expiresAt])
}

model ContactVerificationRequest {
  id                        Int                              @id @default(autoincrement())
  fileId                    String                           @unique
  estimatedTimeOfCompletion DateTime
  limit                     Int?
  notVerifiedSince          DateTime?
  onlyUnverified            Boolean?
  query                     String?
  status                    ContactVerificationRequestStatus @default(processing)
  createdAt                 DateTime                         @default(now())
  updatedAt                 DateTime                         @updatedAt
}

model ApolloQuery {
  id                  Int        @id @default(autoincrement())
  query               String
  apolloQuery         Json
  maxPage             Int
  pageLastFetched     Int
  pageFetchTimeStamps DateTime[]
}

model Lead {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InboundEmail {
  id                Int                 @id @default(autoincrement())
  sender            String
  senderName        String?
  recipient         String
  to                String?
  from              String?
  subject           String?
  date              String?
  mimeVersion       String?
  inReplyTo         String?
  userAgent         String?
  references        String?
  contentType       String?
  messageHeaders    Json?
  received          String?
  messageId         String              @unique
  bodyPlain         String?
  bodyHtml          String?
  strippedText      String?
  strippedHtml      String?
  strippedSignature String?
  attachments       Json?
  attachmentCount   Int?
  contentIdMap      Json?
  mailgunVariables  Json?
  token             String?
  timestamp         Int?
  signature         String?
  userId            String?
  user              User?               @relation(fields: [userId], references: [clerkId], onDelete: Cascade)
  contactId         Int?
  contact           Contact?            @relation(fields: [contactId], references: [id], onDelete: SetNull)
  originalEmailId   Int?
  originalEmail     Email?              @relation("EmailReplies", fields: [originalEmailId], references: [id], onDelete: SetNull)
  campaignId        Int?
  campaign          Campaign?           @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  receivedAt        DateTime            @default(now())
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@index([userId])
  @@index([recipient])
  @@index([sender])
  @@index([contactId])
  @@index([campaignId])
  @@index([receivedAt])
  @@index([messageId])
  @@index([inReplyTo])
}

enum EmailStatus {
  draft
  scheduled
  sent
  failed
}

enum EmailVerificationStatus {
  valid
  invalid
  catch_all
  spamtrap
  abuse
  do_not_mail
  unknown
}

enum HybridBlock {
  introduction
  research
  action
  text
  full_automated
}

enum ContactVerificationRequestStatus {
  processing
  completed
  failed
}

enum AiModel {
  sonar
  sonar_pro @map("sonar-pro")
}

enum UserRole {
  user
  admin
}

enum Status {
  active
  deleted
  archived
}

enum DraftingMode {
  ai
  hybrid
  handwritten
}

enum DraftingTone {
  normal
  explanatory
  formal
  concise
  casual
}
